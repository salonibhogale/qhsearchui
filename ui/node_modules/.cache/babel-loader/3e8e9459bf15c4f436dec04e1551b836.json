{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar query_1 = require(\"../query\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar assign = require('lodash/assign');\n\nvar identity = require('lodash/identity');\n\nvar DynamicRangeAccessor =\n/** @class */\nfunction (_super) {\n  __extends(DynamicRangeAccessor, _super);\n\n  function DynamicRangeAccessor(key, options) {\n    var _this = _super.call(this, key, options.id) || this;\n\n    _this.state = new state_1.ObjectState({});\n    _this.translations = DynamicRangeAccessor.translations;\n    _this.options = options;\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n    _this.options.rangeFormatter = _this.options.rangeFormatter || identity;\n\n    if (options.translations) {\n      _this.translations = assign({}, _this.translations, options.translations);\n    }\n\n    return _this;\n  }\n\n  DynamicRangeAccessor.prototype.getSelectedValue = function (value) {\n    var divider = this.translate('range.divider');\n    return [this.options.rangeFormatter(value.min), divider, this.options.rangeFormatter(value.max)].join('');\n  };\n\n  DynamicRangeAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    if (this.state.hasValue()) {\n      var val = this.state.getValue();\n      var rangeFilter = this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n        gte: val.min,\n        lte: val.max\n      }));\n      var selectedFilter = {\n        name: this.translate(this.options.title),\n        value: this.getSelectedValue(val),\n        id: this.options.id,\n        remove: function () {\n          _this.state = _this.state.clear();\n        }\n      };\n      return query.addFilter(this.key, rangeFilter).addSelectedFilter(selectedFilter);\n    }\n\n    return query;\n  };\n\n  DynamicRangeAccessor.prototype.getStat = function (stat) {\n    return this.getAggregations([this.key, this.fieldContext.getAggregationPath(), this.key, stat], 0);\n  };\n\n  DynamicRangeAccessor.prototype.isDisabled = function () {\n    return this.getStat('count') === 0 || this.getStat('min') === this.getStat('max');\n  };\n\n  DynamicRangeAccessor.prototype.buildOwnQuery = function (query) {\n    var otherFilters = query.getFiltersWithoutKeys(this.key);\n    return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.key, otherFilters], this.fieldContext.wrapAggregations(query_1.StatsMetric(this.key, this.options.field)))));\n  };\n\n  DynamicRangeAccessor.translations = {\n    'range.divider': ' - '\n  };\n  return DynamicRangeAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.DynamicRangeAccessor = DynamicRangeAccessor;","map":{"version":3,"sources":["../../../src/core/accessors/DynamicRangeAccessor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_1 = require(\"../state\");\nvar query_1 = require(\"../query\");\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\nvar assign = require('lodash/assign');\nvar identity = require('lodash/identity');\nvar DynamicRangeAccessor = /** @class */ (function (_super) {\n    __extends(DynamicRangeAccessor, _super);\n    function DynamicRangeAccessor(key, options) {\n        var _this = _super.call(this, key, options.id) || this;\n        _this.state = new state_1.ObjectState({});\n        _this.translations = DynamicRangeAccessor.translations;\n        _this.options = options;\n        _this.options.fieldOptions = _this.options.fieldOptions || { type: 'embedded' };\n        _this.options.fieldOptions.field = _this.options.field;\n        _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n        _this.options.rangeFormatter = _this.options.rangeFormatter || identity;\n        if (options.translations) {\n            _this.translations = assign({}, _this.translations, options.translations);\n        }\n        return _this;\n    }\n    DynamicRangeAccessor.prototype.getSelectedValue = function (value) {\n        var divider = this.translate('range.divider');\n        return [\n            this.options.rangeFormatter(value.min),\n            divider,\n            this.options.rangeFormatter(value.max)\n        ].join('');\n    };\n    DynamicRangeAccessor.prototype.buildSharedQuery = function (query) {\n        var _this = this;\n        if (this.state.hasValue()) {\n            var val = this.state.getValue();\n            var rangeFilter = this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n                gte: val.min,\n                lte: val.max\n            }));\n            var selectedFilter = {\n                name: this.translate(this.options.title),\n                value: this.getSelectedValue(val),\n                id: this.options.id,\n                remove: function () {\n                    _this.state = _this.state.clear();\n                }\n            };\n            return query.addFilter(this.key, rangeFilter).addSelectedFilter(selectedFilter);\n        }\n        return query;\n    };\n    DynamicRangeAccessor.prototype.getStat = function (stat) {\n        return this.getAggregations([this.key, this.fieldContext.getAggregationPath(), this.key, stat], 0);\n    };\n    DynamicRangeAccessor.prototype.isDisabled = function () {\n        return this.getStat('count') === 0 || this.getStat('min') === this.getStat('max');\n    };\n    DynamicRangeAccessor.prototype.buildOwnQuery = function (query) {\n        var otherFilters = query.getFiltersWithoutKeys(this.key);\n        return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.key,\n            otherFilters], this.fieldContext.wrapAggregations(query_1.StatsMetric(this.key, this.options.field)))));\n    };\n    DynamicRangeAccessor.translations = {\n        'range.divider': ' - '\n    };\n    return DynamicRangeAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor));\nexports.DynamicRangeAccessor = DynamicRangeAccessor;\n//# sourceMappingURL=DynamicRangeAccessor.js.map"]},"metadata":{},"sourceType":"script"}