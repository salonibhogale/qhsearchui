{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar query_1 = require(\"../query\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar assign = require('lodash/assign');\n\nvar map = require('lodash/map');\n\nvar omitBy = require('lodash/omitBy');\n\nvar isUndefined = require('lodash/isUndefined');\n\nvar each = require('lodash/each');\n\nvar FacetAccessor =\n/** @class */\nfunction (_super) {\n  __extends(FacetAccessor, _super);\n\n  function FacetAccessor(key, options) {\n    var _this = _super.call(this, key, options.id) || this;\n\n    _this.state = new state_1.ArrayState();\n    _this.translations = FacetAccessor.translations;\n    _this.options = options;\n    _this.defaultSize = options.size;\n    _this.options.facetsPerPage = _this.options.facetsPerPage || 50;\n    _this.size = _this.defaultSize;\n    _this.loadAggregations = isUndefined(_this.options.loadAggregations) ? true : _this.options.loadAggregations;\n\n    if (options.translations) {\n      _this.translations = assign({}, _this.translations, options.translations);\n    }\n\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n    return _this;\n  }\n\n  FacetAccessor.prototype.getRawBuckets = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.options.field, 'buckets'], []);\n  };\n\n  FacetAccessor.prototype.getBuckets = function () {\n    var rawBuckets = this.getRawBuckets();\n    var keyIndex = {};\n    each(rawBuckets, function (item) {\n      item.key = item.key_as_string || String(item.key);\n      keyIndex[item.key] = item;\n    });\n    var missingFilters = [];\n    each(this.state.getValue(), function (filterKey) {\n      if (keyIndex[filterKey]) {\n        var filter = keyIndex[filterKey];\n        filter.selected = true;\n      } else {\n        missingFilters.push({\n          key: filterKey,\n          missing: true,\n          selected: true\n        });\n      }\n    });\n    var buckets = missingFilters.length > 0 ? missingFilters.concat(rawBuckets) : rawBuckets;\n    return buckets;\n  };\n\n  FacetAccessor.prototype.getDocCount = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0);\n  };\n\n  FacetAccessor.prototype.getCount = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.options.field + '_count', 'value'], 0);\n  };\n\n  FacetAccessor.prototype.setViewMoreOption = function (option) {\n    this.size = option.size;\n  };\n\n  FacetAccessor.prototype.getMoreSizeOption = function () {\n    var option = {\n      size: 0,\n      label: ''\n    };\n    var total = this.getCount();\n    var facetsPerPage = this.options.facetsPerPage;\n    if (total <= this.defaultSize) return null;\n\n    if (total <= this.size) {\n      option = {\n        size: this.defaultSize,\n        label: this.translate('facets.view_less')\n      };\n    } else if (this.size + facetsPerPage >= total) {\n      option = {\n        size: total,\n        label: this.translate('facets.view_all')\n      };\n    } else if (this.size + facetsPerPage < total) {\n      option = {\n        size: this.size + facetsPerPage,\n        label: this.translate('facets.view_more')\n      };\n    } else if (total) {\n      option = null;\n    }\n\n    return option;\n  };\n\n  FacetAccessor.prototype.isOrOperator = function () {\n    return this.options.operator === 'OR';\n  };\n\n  FacetAccessor.prototype.getBoolBuilder = function () {\n    return this.isOrOperator() ? query_1.BoolShould : query_1.BoolMust;\n  };\n\n  FacetAccessor.prototype.getOrder = function () {\n    var _a;\n\n    if (this.options.orderKey) {\n      var orderDirection = this.options.orderDirection || 'asc';\n      return _a = {}, _a[this.options.orderKey] = orderDirection, _a;\n    }\n  };\n\n  FacetAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    var filters = this.state.getValue();\n    var filterTerms = map(filters, function (filter) {\n      return _this.fieldContext.wrapFilter(query_1.TermQuery(_this.options.field, filter));\n    });\n    var selectedFilters = map(filters, function (filter) {\n      return {\n        name: _this.options.title || _this.translate(_this.options.field),\n        value: _this.translate(filter),\n        id: _this.options.id,\n        remove: function () {\n          return _this.state = _this.state.remove(filter);\n        }\n      };\n    });\n    var boolBuilder = this.getBoolBuilder();\n\n    if (filterTerms.length > 0) {\n      query = query.addFilter(this.uuid, boolBuilder(filterTerms)).addSelectedFilters(selectedFilters);\n    }\n\n    return query;\n  };\n\n  FacetAccessor.prototype.buildOwnQuery = function (query) {\n    if (!this.loadAggregations) {\n      return query;\n    }\n\n    var excludedKey = this.isOrOperator() ? this.uuid : undefined;\n    return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.uuid, query.getFiltersWithoutKeys(excludedKey)], this.fieldContext.wrapAggregations(query_1.TermsBucket(this.options.field, this.options.field, omitBy({\n      size: this.size,\n      order: this.getOrder(),\n      include: this.options.include,\n      exclude: this.options.exclude,\n      min_doc_count: this.options.min_doc_count\n    }, isUndefined)), query_1.CardinalityMetric(this.options.field + '_count', this.options.field)))));\n  };\n\n  FacetAccessor.translations = {\n    'facets.view_more': 'View more',\n    'facets.view_less': 'View less',\n    'facets.view_all': 'View all'\n  };\n  return FacetAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.FacetAccessor = FacetAccessor;","map":{"version":3,"sources":["../../../src/core/accessors/FacetAccessor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_1 = require(\"../state\");\nvar query_1 = require(\"../query\");\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\nvar assign = require('lodash/assign');\nvar map = require('lodash/map');\nvar omitBy = require('lodash/omitBy');\nvar isUndefined = require('lodash/isUndefined');\nvar each = require('lodash/each');\nvar FacetAccessor = /** @class */ (function (_super) {\n    __extends(FacetAccessor, _super);\n    function FacetAccessor(key, options) {\n        var _this = _super.call(this, key, options.id) || this;\n        _this.state = new state_1.ArrayState();\n        _this.translations = FacetAccessor.translations;\n        _this.options = options;\n        _this.defaultSize = options.size;\n        _this.options.facetsPerPage = _this.options.facetsPerPage || 50;\n        _this.size = _this.defaultSize;\n        _this.loadAggregations = isUndefined(_this.options.loadAggregations)\n            ? true\n            : _this.options.loadAggregations;\n        if (options.translations) {\n            _this.translations = assign({}, _this.translations, options.translations);\n        }\n        _this.options.fieldOptions = _this.options.fieldOptions || { type: 'embedded' };\n        _this.options.fieldOptions.field = _this.options.field;\n        _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n        return _this;\n    }\n    FacetAccessor.prototype.getRawBuckets = function () {\n        return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.options.field, 'buckets'], []);\n    };\n    FacetAccessor.prototype.getBuckets = function () {\n        var rawBuckets = this.getRawBuckets();\n        var keyIndex = {};\n        each(rawBuckets, function (item) {\n            item.key = item.key_as_string || String(item.key);\n            keyIndex[item.key] = item;\n        });\n        var missingFilters = [];\n        each(this.state.getValue(), function (filterKey) {\n            if (keyIndex[filterKey]) {\n                var filter = keyIndex[filterKey];\n                filter.selected = true;\n            }\n            else {\n                missingFilters.push({\n                    key: filterKey,\n                    missing: true,\n                    selected: true\n                });\n            }\n        });\n        var buckets = missingFilters.length > 0 ? missingFilters.concat(rawBuckets) : rawBuckets;\n        return buckets;\n    };\n    FacetAccessor.prototype.getDocCount = function () {\n        return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0);\n    };\n    FacetAccessor.prototype.getCount = function () {\n        return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.options.field + '_count', 'value'], 0);\n    };\n    FacetAccessor.prototype.setViewMoreOption = function (option) {\n        this.size = option.size;\n    };\n    FacetAccessor.prototype.getMoreSizeOption = function () {\n        var option = { size: 0, label: '' };\n        var total = this.getCount();\n        var facetsPerPage = this.options.facetsPerPage;\n        if (total <= this.defaultSize)\n            return null;\n        if (total <= this.size) {\n            option = { size: this.defaultSize, label: this.translate('facets.view_less') };\n        }\n        else if (this.size + facetsPerPage >= total) {\n            option = { size: total, label: this.translate('facets.view_all') };\n        }\n        else if (this.size + facetsPerPage < total) {\n            option = { size: this.size + facetsPerPage, label: this.translate('facets.view_more') };\n        }\n        else if (total) {\n            option = null;\n        }\n        return option;\n    };\n    FacetAccessor.prototype.isOrOperator = function () {\n        return this.options.operator === 'OR';\n    };\n    FacetAccessor.prototype.getBoolBuilder = function () {\n        return this.isOrOperator() ? query_1.BoolShould : query_1.BoolMust;\n    };\n    FacetAccessor.prototype.getOrder = function () {\n        var _a;\n        if (this.options.orderKey) {\n            var orderDirection = this.options.orderDirection || 'asc';\n            return _a = {}, _a[this.options.orderKey] = orderDirection, _a;\n        }\n    };\n    FacetAccessor.prototype.buildSharedQuery = function (query) {\n        var _this = this;\n        var filters = this.state.getValue();\n        var filterTerms = map(filters, function (filter) {\n            return _this.fieldContext.wrapFilter(query_1.TermQuery(_this.options.field, filter));\n        });\n        var selectedFilters = map(filters, function (filter) { return ({\n            name: _this.options.title || _this.translate(_this.options.field),\n            value: _this.translate(filter),\n            id: _this.options.id,\n            remove: function () { return (_this.state = _this.state.remove(filter)); }\n        }); });\n        var boolBuilder = this.getBoolBuilder();\n        if (filterTerms.length > 0) {\n            query = query\n                .addFilter(this.uuid, boolBuilder(filterTerms))\n                .addSelectedFilters(selectedFilters);\n        }\n        return query;\n    };\n    FacetAccessor.prototype.buildOwnQuery = function (query) {\n        if (!this.loadAggregations) {\n            return query;\n        }\n        var excludedKey = this.isOrOperator() ? this.uuid : undefined;\n        return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.uuid,\n            query.getFiltersWithoutKeys(excludedKey)], this.fieldContext.wrapAggregations(query_1.TermsBucket(this.options.field, this.options.field, omitBy({\n            size: this.size,\n            order: this.getOrder(),\n            include: this.options.include,\n            exclude: this.options.exclude,\n            min_doc_count: this.options.min_doc_count\n        }, isUndefined)), query_1.CardinalityMetric(this.options.field + '_count', this.options.field)))));\n    };\n    FacetAccessor.translations = {\n        'facets.view_more': 'View more',\n        'facets.view_less': 'View less',\n        'facets.view_all': 'View all'\n    };\n    return FacetAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor));\nexports.FacetAccessor = FacetAccessor;\n//# sourceMappingURL=FacetAccessor.js.map"]},"metadata":{},"sourceType":"script"}