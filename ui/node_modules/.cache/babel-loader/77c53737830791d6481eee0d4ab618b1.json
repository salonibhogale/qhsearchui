{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar moment = require(\"moment\");\n\nvar lodash_1 = require(\"lodash\");\n\nvar searchkit_1 = require(\"searchkit\");\n\nvar DateRangeQuery_1 = require(\"./DateRangeQuery\");\n\nvar DateRangeAccessor = function (_super) {\n  __extends(DateRangeAccessor, _super);\n\n  function DateRangeAccessor(key, options) {\n    var _this = _super.call(this, key, options.id) || this;\n\n    _this.state = new searchkit_1.ObjectState({});\n\n    _this.clearState = function () {\n      // Need to pass state reset through parent component so view can be updated\n      _this.options.onClearState();\n    };\n\n    _this.options = options;\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: \"embedded\"\n    };\n    _this.fieldContext = searchkit_1.FieldContextFactory(_this.options.fieldOptions);\n    _this.rangeFormatter = _this.options.rangeFormatter || lodash_1.identity;\n    var fromDate = options.fromDate,\n        toDate = options.toDate;\n\n    if (fromDate || toDate) {\n      _this.state = _this.state.setValue({\n        fromDate: fromDate,\n        toDate: toDate\n      });\n    }\n\n    return _this;\n  }\n\n  DateRangeAccessor.prototype.fromQueryObject = function (ob) {\n    var fromValue = ob[this.urlKey + '_from'];\n    var toValue = ob[this.urlKey + '_to'];\n\n    if (fromValue || toValue) {\n      this.state = this.state.setValue({\n        fromDate: fromValue && moment(+fromValue),\n        toDate: toValue && moment(+toValue)\n      });\n    }\n  };\n\n  DateRangeAccessor.prototype.getQueryObject = function () {\n    var val = this.state.getValue();\n    var fromDate = val.fromDate && +val.fromDate;\n    var toDate = val.toDate && +val.toDate;\n    return val ? (_a = {}, _a[this.urlKey + '_from'] = fromDate, _a[this.urlKey + '_to'] = toDate, _a) : {};\n\n    var _a;\n  };\n\n  DateRangeAccessor.prototype.buildSharedQuery = function (query) {\n    if (this.state.hasValue()) {\n      var val = this.state.getValue();\n      var fromDateRangeFilter = this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.fromDateField, {\n        lte: +val.toDate\n      }));\n      var toDateRangeFilter = this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.toDateField, {\n        gte: +val.fromDate\n      }));\n      var fromVal = this.rangeFormatter(val.fromDate);\n      var toVal = this.rangeFormatter(val.toDate);\n      var selectedFilterText = val.toDate ? fromVal + \" \\u2013 \" + toVal : fromVal + \" \\u2013\";\n      var selectedFilter = {\n        name: this.translate(this.options.title),\n        value: selectedFilterText,\n        id: this.options.id,\n        remove: this.clearState\n      };\n      return query.addFilter(this.key + '_to', fromDateRangeFilter).addFilter(this.key + '_from', toDateRangeFilter).addSelectedFilter(selectedFilter);\n    }\n\n    return query;\n  };\n\n  DateRangeAccessor.prototype.getBuckets = function () {\n    return this.getAggregations([this.key, this.fieldContext.getAggregationPath(), this.key, \"buckets\"], []);\n  };\n\n  DateRangeAccessor.prototype.isDisabled = function () {\n    // This accessor is never \"disabled\"; the calendar should always be visible\n    return false;\n  };\n\n  DateRangeAccessor.prototype.buildOwnQuery = function (query) {\n    if (this.state.hasValue()) {\n      var val = this.state.getValue();\n      var otherFilters = query.getFiltersWithoutKeys(this.key);\n      var filters = searchkit_1.BoolMust([otherFilters, this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.fromDateField, {\n        lte: +val.toDate\n      })), this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.toDateField, {\n        gte: +val.fromDate\n      }))]);\n      query = query.setAggs(searchkit_1.FilterBucket(this.key, filters));\n    }\n\n    return query;\n  };\n\n  return DateRangeAccessor;\n}(searchkit_1.FilterBasedAccessor);\n\nexports.DateRangeAccessor = DateRangeAccessor;","map":{"version":3,"sources":["../../src/DateRangeAccessor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar moment = require(\"moment\");\nvar lodash_1 = require(\"lodash\");\nvar searchkit_1 = require(\"searchkit\");\nvar DateRangeQuery_1 = require(\"./DateRangeQuery\");\nvar DateRangeAccessor = (function (_super) {\n    __extends(DateRangeAccessor, _super);\n    function DateRangeAccessor(key, options) {\n        var _this = _super.call(this, key, options.id) || this;\n        _this.state = new searchkit_1.ObjectState({});\n        _this.clearState = function () {\n            // Need to pass state reset through parent component so view can be updated\n            _this.options.onClearState();\n        };\n        _this.options = options;\n        _this.options.fieldOptions = _this.options.fieldOptions || { type: \"embedded\" };\n        _this.fieldContext = searchkit_1.FieldContextFactory(_this.options.fieldOptions);\n        _this.rangeFormatter = _this.options.rangeFormatter || lodash_1.identity;\n        var fromDate = options.fromDate, toDate = options.toDate;\n        if (fromDate || toDate) {\n            _this.state = _this.state.setValue({\n                fromDate: fromDate,\n                toDate: toDate\n            });\n        }\n        return _this;\n    }\n    DateRangeAccessor.prototype.fromQueryObject = function (ob) {\n        var fromValue = ob[this.urlKey + '_from'];\n        var toValue = ob[this.urlKey + '_to'];\n        if (fromValue || toValue) {\n            this.state = this.state.setValue({\n                fromDate: fromValue && moment(+fromValue),\n                toDate: toValue && moment(+toValue)\n            });\n        }\n    };\n    DateRangeAccessor.prototype.getQueryObject = function () {\n        var val = this.state.getValue();\n        var fromDate = val.fromDate && +val.fromDate;\n        var toDate = val.toDate && +val.toDate;\n        return (val) ? (_a = {},\n            _a[this.urlKey + '_from'] = fromDate,\n            _a[this.urlKey + '_to'] = toDate,\n            _a) : {};\n        var _a;\n    };\n    DateRangeAccessor.prototype.buildSharedQuery = function (query) {\n        if (this.state.hasValue()) {\n            var val = this.state.getValue();\n            var fromDateRangeFilter = this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.fromDateField, {\n                lte: +val.toDate\n            }));\n            var toDateRangeFilter = this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.toDateField, {\n                gte: +val.fromDate\n            }));\n            var fromVal = this.rangeFormatter(val.fromDate);\n            var toVal = this.rangeFormatter(val.toDate);\n            var selectedFilterText = (val.toDate)\n                ? fromVal + \" \\u2013 \" + toVal\n                : fromVal + \" \\u2013\";\n            var selectedFilter = {\n                name: this.translate(this.options.title),\n                value: selectedFilterText,\n                id: this.options.id,\n                remove: this.clearState\n            };\n            return query\n                .addFilter(this.key + '_to', fromDateRangeFilter)\n                .addFilter(this.key + '_from', toDateRangeFilter)\n                .addSelectedFilter(selectedFilter);\n        }\n        return query;\n    };\n    DateRangeAccessor.prototype.getBuckets = function () {\n        return this.getAggregations([\n            this.key,\n            this.fieldContext.getAggregationPath(),\n            this.key, \"buckets\"\n        ], []);\n    };\n    DateRangeAccessor.prototype.isDisabled = function () {\n        // This accessor is never \"disabled\"; the calendar should always be visible\n        return false;\n    };\n    DateRangeAccessor.prototype.buildOwnQuery = function (query) {\n        if (this.state.hasValue()) {\n            var val = this.state.getValue();\n            var otherFilters = query.getFiltersWithoutKeys(this.key);\n            var filters = searchkit_1.BoolMust([\n                otherFilters,\n                this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.fromDateField, {\n                    lte: +val.toDate\n                })),\n                this.fieldContext.wrapFilter(DateRangeQuery_1.DateRangeQuery(this.options.toDateField, {\n                    gte: +val.fromDate\n                }))\n            ]);\n            query = query.setAggs(searchkit_1.FilterBucket(this.key, filters));\n        }\n        return query;\n    };\n    return DateRangeAccessor;\n}(searchkit_1.FilterBasedAccessor));\nexports.DateRangeAccessor = DateRangeAccessor;\n//# sourceMappingURL=DateRangeAccessor.js.map"]},"metadata":{},"sourceType":"script"}