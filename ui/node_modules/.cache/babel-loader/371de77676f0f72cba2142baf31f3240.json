{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar support_1 = require(\"../support\");\n\nvar __1 = require(\"../\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar find = require('lodash/find');\n\nvar compact = require('lodash/compact');\n\nvar map = require('lodash/map');\n\nvar filter = require('lodash/filter');\n\nvar omitBy = require('lodash/omitBy');\n\nvar isUndefined = require('lodash/isUndefined');\n\nvar includes = require('lodash/includes');\n\nvar NumericOptionsAccessor =\n/** @class */\nfunction (_super) {\n  __extends(NumericOptionsAccessor, _super);\n\n  function NumericOptionsAccessor(key, options) {\n    var _this = _super.call(this, key) || this;\n\n    _this.state = new state_1.ArrayState();\n    _this.options = options;\n    _this.options.options = support_1.Utils.computeOptionKeys(options.options, ['from', 'to'], 'all');\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = __1.FieldContextFactory(_this.options.fieldOptions);\n    return _this;\n  }\n\n  NumericOptionsAccessor.prototype.getDefaultOption = function () {\n    return find(this.options.options, function (it) {\n      return isUndefined(it.from) && isUndefined(it.to);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOptions = function () {\n    var keys = this.state.getValue();\n    return filter(this.options.options, function (opt) {\n      return includes(keys, opt.key);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOrDefaultOptions = function () {\n    var selectedOptions = this.getSelectedOptions();\n    if (selectedOptions && selectedOptions.length > 0) return selectedOptions;\n    var defaultOption = this.getDefaultOption();\n    if (defaultOption) return [defaultOption];\n    return [];\n  };\n\n  NumericOptionsAccessor.prototype.setOptions = function (titles) {\n    if (titles.length === 1) {\n      this.state = this.state.clear();\n      this.toggleOption(titles[0]);\n    } else {\n      var keys = map(filter(this.options.options, function (opt) {\n        return includes(titles, opt.title);\n      }), 'key');\n      this.state = this.state.setValue(keys);\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.toggleOption = function (key) {\n    var option = find(this.options.options, {\n      title: key\n    });\n\n    if (option) {\n      if (option === this.getDefaultOption()) {\n        this.state = this.state.clear();\n      } else if (this.options.multiselect) {\n        this.state = this.state.toggle(option.key);\n      } else {\n        this.state = this.state.setValue([option.key]);\n      }\n\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.getBuckets = function () {\n    return filter(this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'], []), this.emptyOptionsFilter);\n  };\n\n  NumericOptionsAccessor.prototype.getDocCount = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0);\n  };\n\n  NumericOptionsAccessor.prototype.emptyOptionsFilter = function (option) {\n    return option.doc_count > 0;\n  };\n\n  NumericOptionsAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    var filters = this.getSelectedOptions();\n    var filterRanges = map(filters, function (filter) {\n      return _this.fieldContext.wrapFilter(__1.RangeQuery(_this.options.field, {\n        gte: filter.from,\n        lt: filter.to\n      }));\n    });\n    var selectedFilters = map(filters, function (filter) {\n      return {\n        name: _this.translate(_this.options.title),\n        value: _this.translate(filter.title),\n        id: _this.options.id,\n        remove: function () {\n          return _this.state = _this.state.remove(filter.key);\n        }\n      };\n    });\n\n    if (filterRanges.length > 0) {\n      query = query.addFilter(this.uuid, __1.BoolShould(filterRanges)).addSelectedFilters(selectedFilters);\n    }\n\n    return query;\n  };\n\n  NumericOptionsAccessor.prototype.getRanges = function () {\n    return compact(map(this.options.options, function (range) {\n      return omitBy({\n        key: range.title,\n        from: range.from,\n        to: range.to\n      }, isUndefined);\n    }));\n  };\n\n  NumericOptionsAccessor.prototype.buildOwnQuery = function (query) {\n    return query.setAggs(__1.FilterBucket.apply(void 0, __spreadArrays([this.uuid, query.getFiltersWithoutKeys(this.uuid)], this.fieldContext.wrapAggregations(__1.RangeBucket(this.key, this.options.field, this.getRanges())))));\n  };\n\n  return NumericOptionsAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.NumericOptionsAccessor = NumericOptionsAccessor;","map":{"version":3,"sources":["../../../src/core/accessors/NumericOptionsAccessor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_1 = require(\"../state\");\nvar support_1 = require(\"../support\");\nvar __1 = require(\"../\");\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\nvar find = require('lodash/find');\nvar compact = require('lodash/compact');\nvar map = require('lodash/map');\nvar filter = require('lodash/filter');\nvar omitBy = require('lodash/omitBy');\nvar isUndefined = require('lodash/isUndefined');\nvar includes = require('lodash/includes');\nvar NumericOptionsAccessor = /** @class */ (function (_super) {\n    __extends(NumericOptionsAccessor, _super);\n    function NumericOptionsAccessor(key, options) {\n        var _this = _super.call(this, key) || this;\n        _this.state = new state_1.ArrayState();\n        _this.options = options;\n        _this.options.options = support_1.Utils.computeOptionKeys(options.options, ['from', 'to'], 'all');\n        _this.options.fieldOptions = _this.options.fieldOptions || { type: 'embedded' };\n        _this.options.fieldOptions.field = _this.options.field;\n        _this.fieldContext = __1.FieldContextFactory(_this.options.fieldOptions);\n        return _this;\n    }\n    NumericOptionsAccessor.prototype.getDefaultOption = function () {\n        return find(this.options.options, function (it) { return isUndefined(it.from) && isUndefined(it.to); });\n    };\n    NumericOptionsAccessor.prototype.getSelectedOptions = function () {\n        var keys = this.state.getValue();\n        return filter(this.options.options, function (opt) { return includes(keys, opt.key); });\n    };\n    NumericOptionsAccessor.prototype.getSelectedOrDefaultOptions = function () {\n        var selectedOptions = this.getSelectedOptions();\n        if (selectedOptions && selectedOptions.length > 0)\n            return selectedOptions;\n        var defaultOption = this.getDefaultOption();\n        if (defaultOption)\n            return [defaultOption];\n        return [];\n    };\n    NumericOptionsAccessor.prototype.setOptions = function (titles) {\n        if (titles.length === 1) {\n            this.state = this.state.clear();\n            this.toggleOption(titles[0]);\n        }\n        else {\n            var keys = map(filter(this.options.options, function (opt) { return includes(titles, opt.title); }), 'key');\n            this.state = this.state.setValue(keys);\n            this.searchkit.performSearch();\n        }\n    };\n    NumericOptionsAccessor.prototype.toggleOption = function (key) {\n        var option = find(this.options.options, { title: key });\n        if (option) {\n            if (option === this.getDefaultOption()) {\n                this.state = this.state.clear();\n            }\n            else if (this.options.multiselect) {\n                this.state = this.state.toggle(option.key);\n            }\n            else {\n                this.state = this.state.setValue([option.key]);\n            }\n            this.searchkit.performSearch();\n        }\n    };\n    NumericOptionsAccessor.prototype.getBuckets = function () {\n        return filter(this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'], []), this.emptyOptionsFilter);\n    };\n    NumericOptionsAccessor.prototype.getDocCount = function () {\n        return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0);\n    };\n    NumericOptionsAccessor.prototype.emptyOptionsFilter = function (option) {\n        return option.doc_count > 0;\n    };\n    NumericOptionsAccessor.prototype.buildSharedQuery = function (query) {\n        var _this = this;\n        var filters = this.getSelectedOptions();\n        var filterRanges = map(filters, function (filter) {\n            return _this.fieldContext.wrapFilter(__1.RangeQuery(_this.options.field, {\n                gte: filter.from,\n                lt: filter.to\n            }));\n        });\n        var selectedFilters = map(filters, function (filter) { return ({\n            name: _this.translate(_this.options.title),\n            value: _this.translate(filter.title),\n            id: _this.options.id,\n            remove: function () { return (_this.state = _this.state.remove(filter.key)); }\n        }); });\n        if (filterRanges.length > 0) {\n            query = query\n                .addFilter(this.uuid, __1.BoolShould(filterRanges))\n                .addSelectedFilters(selectedFilters);\n        }\n        return query;\n    };\n    NumericOptionsAccessor.prototype.getRanges = function () {\n        return compact(map(this.options.options, function (range) {\n            return omitBy({\n                key: range.title,\n                from: range.from,\n                to: range.to\n            }, isUndefined);\n        }));\n    };\n    NumericOptionsAccessor.prototype.buildOwnQuery = function (query) {\n        return query.setAggs(__1.FilterBucket.apply(void 0, __spreadArrays([this.uuid,\n            query.getFiltersWithoutKeys(this.uuid)], this.fieldContext.wrapAggregations(__1.RangeBucket(this.key, this.options.field, this.getRanges())))));\n    };\n    return NumericOptionsAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor));\nexports.NumericOptionsAccessor = NumericOptionsAccessor;\n//# sourceMappingURL=NumericOptionsAccessor.js.map"]},"metadata":{},"sourceType":"script"}