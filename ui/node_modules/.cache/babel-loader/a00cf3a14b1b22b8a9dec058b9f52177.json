{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar query_1 = require(\"../query\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar identity = require('lodash/identity');\n\nvar maxBy = require('lodash/maxBy');\n\nvar get = require('lodash/get');\n\nvar assign = require('lodash/assign');\n\nvar RangeAccessor =\n/** @class */\nfunction (_super) {\n  __extends(RangeAccessor, _super);\n\n  function RangeAccessor(key, options) {\n    var _this = _super.call(this, key, options.id) || this;\n\n    _this.state = new state_1.ObjectState({});\n    _this.translations = RangeAccessor.translations;\n    _this.options = options;\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n    _this.options.rangeFormatter = _this.options.rangeFormatter || identity;\n\n    if (options.translations) {\n      _this.translations = assign({}, _this.translations, options.translations);\n    }\n\n    return _this;\n  }\n\n  RangeAccessor.prototype.getSelectedValue = function (value) {\n    var divider = this.translate('range.divider');\n    return [this.options.rangeFormatter(value.min), divider, this.options.rangeFormatter(value.max)].join('');\n  };\n\n  RangeAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    if (this.state.hasValue()) {\n      var val = this.state.getValue();\n      var rangeFilter = this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n        gte: val.min,\n        lte: val.max\n      }));\n      var selectedFilter = {\n        name: this.translate(this.options.title),\n        value: this.getSelectedValue(val),\n        id: this.options.id,\n        remove: function () {\n          _this.state = _this.state.clear();\n        }\n      };\n      return query.addFilter(this.uuid, rangeFilter).addSelectedFilter(selectedFilter);\n    }\n\n    return query;\n  };\n\n  RangeAccessor.prototype.getBuckets = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'], []);\n  };\n\n  RangeAccessor.prototype.isDisabled = function () {\n    if (this.options.loadHistogram) {\n      var maxValue = get(maxBy(this.getBuckets(), 'doc_count'), 'doc_count', 0);\n      return maxValue === 0;\n    }\n\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'value'], 0) === 0;\n  };\n\n  RangeAccessor.prototype.getInterval = function () {\n    if (this.options.interval) {\n      return this.options.interval;\n    }\n\n    return Math.ceil((this.options.max - this.options.min) / 20);\n  };\n\n  RangeAccessor.prototype.buildOwnQuery = function (query) {\n    var otherFilters = query.getFiltersWithoutKeys(this.uuid);\n    var filters = query_1.BoolMust([otherFilters, this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n      gte: this.options.min,\n      lte: this.options.max\n    }))]);\n    var metric;\n\n    if (this.options.loadHistogram) {\n      metric = query_1.HistogramBucket(this.key, this.options.field, {\n        interval: this.getInterval(),\n        min_doc_count: 0,\n        extended_bounds: {\n          min: this.options.min,\n          max: this.options.max\n        }\n      });\n    } else {\n      metric = query_1.CardinalityMetric(this.key, this.options.field);\n    }\n\n    return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.uuid, filters], this.fieldContext.wrapAggregations(metric))));\n  };\n\n  RangeAccessor.translations = {\n    'range.divider': ' - '\n  };\n  return RangeAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.RangeAccessor = RangeAccessor;","map":{"version":3,"sources":["../../../src/core/accessors/RangeAccessor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_1 = require(\"../state\");\nvar query_1 = require(\"../query\");\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\nvar identity = require('lodash/identity');\nvar maxBy = require('lodash/maxBy');\nvar get = require('lodash/get');\nvar assign = require('lodash/assign');\nvar RangeAccessor = /** @class */ (function (_super) {\n    __extends(RangeAccessor, _super);\n    function RangeAccessor(key, options) {\n        var _this = _super.call(this, key, options.id) || this;\n        _this.state = new state_1.ObjectState({});\n        _this.translations = RangeAccessor.translations;\n        _this.options = options;\n        _this.options.fieldOptions = _this.options.fieldOptions || { type: 'embedded' };\n        _this.options.fieldOptions.field = _this.options.field;\n        _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n        _this.options.rangeFormatter = _this.options.rangeFormatter || identity;\n        if (options.translations) {\n            _this.translations = assign({}, _this.translations, options.translations);\n        }\n        return _this;\n    }\n    RangeAccessor.prototype.getSelectedValue = function (value) {\n        var divider = this.translate('range.divider');\n        return [\n            this.options.rangeFormatter(value.min),\n            divider,\n            this.options.rangeFormatter(value.max)\n        ].join('');\n    };\n    RangeAccessor.prototype.buildSharedQuery = function (query) {\n        var _this = this;\n        if (this.state.hasValue()) {\n            var val = this.state.getValue();\n            var rangeFilter = this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n                gte: val.min,\n                lte: val.max\n            }));\n            var selectedFilter = {\n                name: this.translate(this.options.title),\n                value: this.getSelectedValue(val),\n                id: this.options.id,\n                remove: function () {\n                    _this.state = _this.state.clear();\n                }\n            };\n            return query.addFilter(this.uuid, rangeFilter).addSelectedFilter(selectedFilter);\n        }\n        return query;\n    };\n    RangeAccessor.prototype.getBuckets = function () {\n        return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'], []);\n    };\n    RangeAccessor.prototype.isDisabled = function () {\n        if (this.options.loadHistogram) {\n            var maxValue = get(maxBy(this.getBuckets(), 'doc_count'), 'doc_count', 0);\n            return maxValue === 0;\n        }\n        return (this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'value'], 0) === 0);\n    };\n    RangeAccessor.prototype.getInterval = function () {\n        if (this.options.interval) {\n            return this.options.interval;\n        }\n        return Math.ceil((this.options.max - this.options.min) / 20);\n    };\n    RangeAccessor.prototype.buildOwnQuery = function (query) {\n        var otherFilters = query.getFiltersWithoutKeys(this.uuid);\n        var filters = query_1.BoolMust([\n            otherFilters,\n            this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n                gte: this.options.min,\n                lte: this.options.max\n            }))\n        ]);\n        var metric;\n        if (this.options.loadHistogram) {\n            metric = query_1.HistogramBucket(this.key, this.options.field, {\n                interval: this.getInterval(),\n                min_doc_count: 0,\n                extended_bounds: {\n                    min: this.options.min,\n                    max: this.options.max\n                }\n            });\n        }\n        else {\n            metric = query_1.CardinalityMetric(this.key, this.options.field);\n        }\n        return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.uuid, filters], this.fieldContext.wrapAggregations(metric))));\n    };\n    RangeAccessor.translations = {\n        'range.divider': ' - '\n    };\n    return RangeAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor));\nexports.RangeAccessor = RangeAccessor;\n//# sourceMappingURL=RangeAccessor.js.map"]},"metadata":{},"sourceType":"script"}